<!--
 * @Author: SnotlingLiu<snotlingliu@gmail.com/>
 * @Date: 2023-02-14 09:34:37
 * @LastEditors: SnotlingLiu<snotlingliu@gmail.com/>
 * @LastEditTime: 2023-02-14 10:06:21
 * @Description: 
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>SDK代码示例模板</title>
    <style>
        html,
        body,
        #main {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div id="main"></div>
    <script>
        window.Space_BASEURL = "/";

        let space, position;
        window.onload = () => {
            position = VRGlobe.Position3D.fromCoordinates([108.40, 30.59]);

            space = new VRGlobe.Space('main');
            space.__v.clock.shouldAnimate = true;
            space.__v.scene.debugShowFramesPerSecond = true;
            space.__v.scene.globe.depthTestAgainstTerrain = true;

            space.__v.scene.imageryLayers.addImageryProvider(
                new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYESRIIMG)
            );
            space.__v.terrainProvider = new VRGlobe.TerrainLayer(VRGlobe.Type.TERRAINSEELEVEL);
        }



        // 创建矢量瓦片图层
        function addFeatureLayer() {
            const featureLayer = new VRGlobe.FeatureLayer(
                "http://127.0.0.1:129/Data/ChongQing/TopoJson/ChongQing_All/EPSG_4326_{z}/{x}_{reverseY}.topojson", {
                minimumLevel: 10,
                maximumLevel: 15,
                fillColor: 'rgba(3, 104, 255, 0.5)',
                strokeColor: 'rgba(30, 242, 220, 1)',
                rectangle: VRGlobe.Rectangle.fromDegrees(105.46857703157171, 28.454715693000026, 109.15871584761804, 31.568847758087273),
            });
            space.__v.scene.imageryLayers.addImageryProvider(featureLayer);

            var points = space.__v.scene.primitives.add(
                new VRGlobe.PointPrimitiveCollection()
            );
            var point = points.add({
                pixelSize: 10,
                color: VRGlobe.Color.RED,
                position: VRGlobe.Cartesian3.fromDegrees(108.40, 30.59),
            });
        }

        // 创建矢量图层
        function addGraphicsLayer() {
            const mode = VRGlobe.Mode.NONE;
            VRGlobe.GraphicsLayer.fromGeojson(
                VRGlobe.Type.GEOJSONPOINT,
                'http://127.0.0.1:129/SDKData/point.json'
            ).then(graphicsLayer => {
                graphicsLayer.annotationStyle.mode = mode;
                space.__v.scene.primitives.add(graphicsLayer);
            });

            VRGlobe.GraphicsLayer.fromGeojson(
                VRGlobe.Type.GEOJSONMULTILINESTRING,
                'http://127.0.0.1:129/SDKData/MultiLineString.json'
            ).then(graphicsLayer => {
                graphicsLayer.annotationStyle.mode = mode;
                space.__v.scene.primitives.add(graphicsLayer);
            });

            VRGlobe.GraphicsLayer.fromGeojson(
                VRGlobe.Type.GEOJSONPOLYGON,
                'http://127.0.0.1:129/SDKData/Polygon.json'
            ).then(graphicsLayer => {
                graphicsLayer.annotationStyle.mode = mode;
                space.__v.scene.primitives.add(graphicsLayer);
            });
        }

        // 创建高德矢量注记瓦片地图
        function addAMapCVAImageryLayer() {
            space.__v.scene.imageryLayers.addImageryProvider(
                new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYAMAPCVA)
            );
        }

        let layer;
        // 创建高德影像瓦片地图
        function addAMapIMGImageryLayer() {
            layer = new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYAMAPIMG);
            space.__v.scene.imageryLayers.addImageryProvider(layer);
        }

        // 高德矢量瓦片地图
        function addAMapVECImageryLayer() {
            layer = new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYAMAPVEC)
            space.__v.scene.imageryLayers.addImageryProvider(layer);
        }

        // 创建坐标系为BD-09坐标系百度标注的地图
        function addBDCVAImageryLayer() {
            layer = new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYBDCVA);
            space.__v.scene.imageryLayers.addImageryProvider(layer);
        }

        // 创建坐标系为BD-09坐标系百度矢量的地图
        function addBDCVAImageryLayer() {
            layer = new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYBDVEC);
            space.__v.scene.imageryLayers.addImageryProvider(layer);
        }

        // 创建坐标系为BD-09坐标系百度影像的地图
        function addBDCVAImageryLayer() {
            layer = new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYBDIMG);
            space.__v.scene.imageryLayers.addImageryProvider(layer);
        }

        // 创建ESRI矢量地图MapServer服务
        function addESRIIMGImageryLayer() {
            layer = new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYESRIIMG);
            space.__v.scene.imageryLayers.addImageryProvider(layer);
        }

        // 创建ESRI影像地图MapServer服务
        function addESRIVECImageryLayer() {
            layer = new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYESRIVEC);
            space.__v.scene.imageryLayers.addImageryProvider(layer);
        }

        // 创建腾讯影像瓦片地图
        function addTENCENTIMGImageryLayer() {
            layer = new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYTENCENTIMG);
            space.__v.scene.imageryLayers.addImageryProvider(layer);
        }

        // 创建腾讯矢量瓦片地图
        function addTENCENTVECImageryLayer() {
            layer = new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYTENCENTVEC);
            space.__v.scene.imageryLayers.addImageryProvider(layer);
        }

        let model;
        // 添加白模图层
        function addModelTilesetLayer() {
            // 加载白模
            model = new VRGlobe.ModelTilesetLayer('http://192.168.1.119:6006/CDBuild3DTileset/tileset.json');
            space.__v.scene.primitives.add(model);
            model.readyPromise.then(tileset => {
                // 跳转到白模
                space.__v.camera.flyToBoundingSphere(tileset.boundingSphere);
            });
        }

        // 设置模型颜色
        function setColor(color) {
            color = color || VRGlobe.Color.fromRandom({
                alpha: 1
            });
            model.colorPropertyType = VRGlobe.Type.PROPERTYSPACIAL;
            model.color = color;
        }

        // 模型按照唯一值设色
        function setColorByUniqueValue() {
            model.attributeName = "county";
            model.colorPropertyType = VRGlobe.Type.PROPERTYUNIQUE;
            model.colorProperty.removeAllCondition();
            model.colorProperty.addCondition("双流区", VRGlobe.Color.fromCssColorString('rgb(252, 202, 209)'));
            model.colorProperty.addCondition("大邑县", VRGlobe.Color.fromCssColorString('rgb(185, 252, 182)'));
            model.colorProperty.addCondition("崇州市", VRGlobe.Color.fromCssColorString('rgb(187, 240, 252)'));
            model.colorProperty.addCondition("彭州市", VRGlobe.Color.fromCssColorString('rgb(185, 179, 252)'));
            model.colorProperty.addCondition("成华区", VRGlobe.Color.fromCssColorString('rgb(252, 237, 184)'));
            model.colorProperty.addCondition("新津县", VRGlobe.Color.fromCssColorString('rgb(252, 179, 235)'));
            model.colorProperty.addCondition("新都区", VRGlobe.Color.fromCssColorString('rgb(217, 215, 252)'));
            model.colorProperty.addCondition("武侯区", VRGlobe.Color.fromCssColorString('rgb(202, 252, 221)'));
            model.colorProperty.addCondition("温江区", VRGlobe.Color.fromCssColorString('rgb(252, 207, 182)'));
            model.colorProperty.addCondition("简阳市", VRGlobe.Color.fromCssColorString('rgb(237, 252, 210)'));
            model.colorProperty.addCondition("蒲江县", VRGlobe.Color.fromCssColorString('rgb(252, 207, 245)'));
            model.colorProperty.addCondition("邛崃市", VRGlobe.Color.fromCssColorString('rgb(179, 210, 252)'));
            model.colorProperty.addCondition("郫都区", VRGlobe.Color.fromCssColorString('rgb(252, 182, 210)'));
            model.colorProperty.addCondition("都江堰市", VRGlobe.Color.fromCssColorString('rgb(223, 184, 252)'));
            model.colorProperty.addCondition("金堂县", VRGlobe.Color.fromCssColorString('rgb(228, 252, 187)'));
            model.colorProperty.addCondition("金牛区", VRGlobe.Color.fromCssColorString('rgb(252, 240, 215)'));
            model.colorProperty.addCondition("锦江区", VRGlobe.Color.fromCssColorString('rgb(202, 197, 252)'));
            model.colorProperty.addCondition("青白江区", VRGlobe.Color.fromCssColorString('rgb(215, 252, 243)'));
            model.colorProperty.addCondition("青羊区", VRGlobe.Color.fromCssColorString('rgb(252, 222, 215)'));
            model.colorProperty.addCondition("龙泉驿区", VRGlobe.Color.fromCssColorString('rgb(202, 252, 197)'));
            model.updateStyle();
        }

        // 模型按照面积分级设色
        function setColorByGraduatedValue() {
            model.attributeName = "area";
            model.colorPropertyType = VRGlobe.Type.PROPERTYGRADUATED;
            model.colorProperty.removeAllCondition();
            model.colorProperty.addCondition("(-,100]", VRGlobe.Color.fromCssColorString('rgba(84, 255, 159, 0.7843137254901961)'));
            model.colorProperty.addCondition("(100,250]", VRGlobe.Color.fromCssColorString('rgba(0, 255, 127, 0.7843137254901961)'));
            model.colorProperty.addCondition("(250,450]", VRGlobe.Color.fromCssColorString('rgba(0, 255, 0, 0.7843137254901961)'));
            model.colorProperty.addCondition("(450,+)", VRGlobe.Color.fromCssColorString('rgba(192, 255, 62, 0.7843137254901961)'));
            model.updateStyle();
        }

        // 模型按照高度分级设色
        function setColorByHeight() {
            model.attributeName = "height";
            model.colorPropertyType = VRGlobe.Type.PROPERTYGRADUATED;
            model.colorProperty.removeAllCondition();
            model.colorProperty.addCondition("(-,20]", VRGlobe.Color.fromCssColorString('rgb(255, 160, 122)'));
            model.colorProperty.addCondition("(20,50]", VRGlobe.Color.fromCssColorString('rgb(240, 128, 128)'));
            model.colorProperty.addCondition("(50,90]", VRGlobe.Color.fromCssColorString('rgb(255, 99, 71)'));
            model.updateStyle();
        }

        // 火粒子
        function addFireParticle() {
            const layer = space.__v.scene.primitives.add(new VRGlobe.ParticleLayer());
            layer.addParticle(VRGlobe.Type.FIREPARTICLE, VRGlobe.Position3D.fromCoordinates([108.402, 30.59]), {
                loop: true,
                show: true,
                scale: [0.5, 8.0],
                speed: [0.05, 2],
                image: "http://127.0.0.1:129/SampleData/fire.png",
                bursts: [{
                    time: 5.0,
                    minimum: 10,
                    maximum: 100,
                }],
                gravity: 0.5,
                lifetime: 6.0,
                direction: VRGlobe.Direction.ZERO,
                emitterType: VRGlobe.Type.CIRCLEEMITTER,
                emissionRate: 60,
                emitterRadius: 10,
                particleLife: [1, 2],
                imageSize: [6, 24],
            });
        }
        // 烟雾粒子
        function addSmokeParticle() {
            const layer = space.__v.scene.primitives.add(new VRGlobe.ParticleLayer());
            layer.addParticle(VRGlobe.Type.SMOKEPARTICLE, VRGlobe.Position3D.fromCoordinates([108.401, 30.59, 1]), {
                mass: [1, 10],
                loop: true,
                show: true,
                color: [
                    new VRGlobe.Color(0.9607843137254902, 0.9607843137254902, 0.9607843137254902, 0.25),
                    new VRGlobe.Color(0.9607843137254902, 0.9607843137254902, 0.9607843137254902, 0.01)
                ],
                image: "http://127.0.0.1:129/SampleData/smoke.png",
                scale: [1, 8],
                speed: [0.05, 2],
                bursts: [{
                    time: 5.0,
                    minimum: 10,
                    maximum: 100,
                }],
                gravity: 0.1,
                lifetime: 10,
                position: VRGlobe.Position3D.fromCoordinates([108.40, 30.59]),
                direction: VRGlobe.Direction.ZERO,
                imageSize: 24,
                particleLife: [5, 10],
                emitterType: VRGlobe.Type.BOXEMITTER,
                emissionRate: 100,
                emitterRadius: 100,
            });
        }
        // 喷泉
        function addFountainParticle() {
            const layer = space.__v.scene.primitives.add(new VRGlobe.ParticleLayer());
            layer.addParticle(VRGlobe.Type.WATERPARTICLE, VRGlobe.Position3D.fromCoordinates([108.40, 30.591, 1]), {
                mass: 1.0,
                loop: true,
                show: true,
                color: [
                    new VRGlobe.Color(0.9607843137254902, 0.9607843137254902, 0.9607843137254902, 0.25),
                    new VRGlobe.Color(0.9607843137254902, 0.9607843137254902, 0.9607843137254902, 0.01)
                ],
                image: "http://127.0.0.1:129/SampleData/smoke.png",
                scale: 1.0,
                speed: 1.0,
                gravity: -5,
                lifetime: 4,
                direction: VRGlobe.Direction.ZERO,
                imageSize: [10, 40],
                particleLife: 5.0,
                emitterType: VRGlobe.Type.CONEEMITTER,
                emissionRate: 120,
                emitterRadius: 1,
            })
        }
        // 水柱
        function addSpoutParticle() {
            const layer = space.__v.scene.primitives.add(new VRGlobe.ParticleLayer());
            layer.addParticle(VRGlobe.Type.WATERPARTICLE, VRGlobe.Position3D.fromCoordinates([108.401, 30.591, 10]), {
                mass: [0.5, 10],
                loop: true,
                show: true,
                color: [
                    new VRGlobe.Color(0.9607843137254902, 0.9607843137254902, 0.9607843137254902, 0.25),
                    new VRGlobe.Color(0.9607843137254902, 0.9607843137254902, 0.9607843137254902, 0.01)
                ],
                image: "http://127.0.0.1:129/SampleData/smoke.png",
                scale: [1, 2],
                speed: [3, 4],
                gravity: -1.5,
                lifetime: 10,
                direction: new VRGlobe.Direction(0, 90, 0),
                imageSize: [10, 40],
                particleLife: [1, 10],
                emitterType: VRGlobe.Type.CIRCLEEMITTER,
                emissionRate: 240,
                emitterRadius: 1,
            })
        }
        // 爆炸
        function addBurstParticle() {
            const layer = space.__v.scene.primitives.add(new VRGlobe.ParticleLayer());
            layer.addParticle(VRGlobe.Type.FIREPARTICLE, position, {
                color: VRGlobe.Color.fromCssColorString('rgba(238,85,34,0.5)'),
                image: "http://127.0.0.1:129/SampleData/fire.png",
                scale: [1, 8],
                speed: [0.05, 1],
                bursts: [
                    { time: 4.5, minimum: 500, maximum: 800 },
                    { time: 4.55, minimum: 100, maximum: 800 },
                    { time: 4.6, minimum: 100, maximum: 1000 },
                    { time: 4.65, minimum: 100, maximum: 100 },
                    { time: 4.7, minimum: 10, maximum: 200 },
                    { time: 4.75, minimum: 10, maximum: 200 },
                ],
                gravity: 0.1,
                lifetime: 4,
                position: VRGlobe.Position3D.fromCoordinates([108.402, 30.59]),
                direction: VRGlobe.Direction.ZERO,
                imageSize: [12, 24],
                particleLife: [0.5, 1],
                emitterType: VRGlobe.Type.BOXEMITTER,
                emissionRate: 5,
                emitterRadius: 0.03,
            });
            layer.addParticle(VRGlobe.Type.FIREPARTICLE, position, {
                mass: [1, 10],
                color: VRGlobe.Color.fromCssColorString('#0a0a0a'),
                image: "http://127.0.0.1:129/SampleData/smoke.png",
                scale: [1, 8],
                speed: [0.05, 1],
                gravity: 0.01,
                lifetime: 12,
                position: VRGlobe.Position3D.fromCoordinates([108.402, 30.59]),
                direction: VRGlobe.Direction.ZERO,
                imageSize: 24,
                particleLife: [6, 12],
                emitterType: VRGlobe.Type.BOXEMITTER,
                emissionRate: 30,
                emitterRadius: 0.1,
            });
        }

        // 添加倾斜摄影模型图层
        function addPhotographyLayer() {
            // 加载倾斜摄影
            let photography = new VRGlobe.TDTilesetLayer("http://192.168.1.119:6006/CQEstateData/3dtiles/CQLiangJiang3DTiles/tileset.json");
            space.__v.scene.primitives.add(photography);

            photography.readyPromise.then(tileset => {
                // 跳转到倾斜摄影
                space.__v.camera.flyToBoundingSphere(tileset.boundingSphere);
            });
        }

        // 添加点云模型图层
        function addPointCloudLayer() {
            // 加载点云
            let pointCloud = new VRGlobe.TDTilesetLayer("http://192.168.1.119:6006/PointCloud/TownRoad/tileset.json");
            space.__v.scene.primitives.add(pointCloud);

            pointCloud.readyPromise.then(tileset => {
                // 跳转到倾斜摄影
                space.__v.camera.flyToBoundingSphere(tileset.boundingSphere);
            });
        }

        // 设置高程为海平面
        function setSeeLevelTerrain() {
            // 海平面
            let layer = new VRGlobe.TerrainLayer(VRGlobe.Type.TERRAINSEELEVEL);
            space.__v.terrainProvider = layer;
        }

        // 设置高程为地形网格
        function setQuantizedTerrain() {
            // 超图公网地形
            layer = new VRGlobe.TerrainLayer(VRGlobe.Type.TERRAINQUANTIZED, {
                url: "https://www.supermapol.com/realspace/services/3D-stk_terrain/rest/realspace/datas/info/data/path"
            });
            space.__v.terrainProvider = layer;
        }

    </script>
</body>

</html>