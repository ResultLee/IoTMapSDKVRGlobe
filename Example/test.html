<!--
 * @Author: SnotlingLiu<snotlingliu@gmail.com/>
 * @Date: 2023-02-14 09:34:37
 * @LastEditors: SnotlingLiu<snotlingliu@gmail.com/>
 * @LastEditTime: 2023-02-14 10:06:21
 * @Description: 
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Use correct character set. -->
    <meta charset="utf-8" />
    <!-- Tell IE to use the latest, best version. -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
    <script src="../Build/VRGlobe/VRGlobe.js"></script>
    <link rel="stylesheet" href="../Build/VRGlobe/Widgets/widgets.css" />
    <title>VRGlobe打包后文件测试代码</title>
    <style>
        html,
        body,
        #main {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div id="main"></div>
    <script>
        // VRGlobe.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJlNDYwZDg5OS1iYjQ2LTQyNjEtYTgyYS0wOTMwZTRiOTViZmMiLCJpZCI6NTQyNCwiaWF0IjoxNjc1NzU5MTI5fQ.8Vf2LXy0DY44BEs9RzTh0WN1RWK8F-I2hykYNxk46YQ";
        window.Space_BASEURL = "http://127.0.0.1:5500/Build/VRGlobe/"
        var space = new VRGlobe.Space('main', {
            imageryProvider: new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYESRIVEC)
        });

        // const url = 'http://192.168.1.115:8888/topojson/sde_cqdk1128/11/3269/688.topojson';
        // const url = 'http://192.168.1.115:8888/topojson/sde_cqdk1128/{z}/{x}/{y}.topojson';

        // 测试
        // const url = 'http://localhost:2048/geoserver/SnotlingLiu/gwc/service/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&LAYER=SnotlingLiu:lizhi&STYLE=&TILEMATRIX=EPSG:4326:{z}&TILEMATRIXSET=EPSG:4326&FORMAT=application/json\;type=topojson&TILECOL={x}&TILEROW={y}';

        // 500101
        // const url = 'http://localhost:2048/geoserver/ChongQing/gwc/service/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&LAYER=ChongQing:500101&STYLE=&TILEMATRIX=EPSG:4326:{z}&TILEMATRIXSET=EPSG:4326&FORMAT=application/json;type=topojson&TILECOL={x}&TILEROW={y}';
        let url101 = 'http://127.0.0.1:129/Data/ChongQing/TopoJson/500101/EPSG_4326_{z}/{x}_{reverseY}.topojson';

        // 500102
        let url102 = 'http://127.0.0.1:129/Data/ChongQing/TopoJson/500102/EPSG_4326_{z}/{x}_{reverseY}.topojson';

        // 500103
        let url103 = 'http://127.0.0.1:129/Data/ChongQing/TopoJson/500103/EPSG_4326_{z}/{x}_{reverseY}.topojson';

        // 500104
        let url104 = 'http://127.0.0.1:129/Data/ChongQing/TopoJson/500104/EPSG_4326_{z}/{x}_{reverseY}.topojson';

        // 500105
        let url105 = 'http://127.0.0.1:129/Data/ChongQing/TopoJson/500105/EPSG_4326_{z}/{x}_{reverseY}.topojson';




        var viewer = space.__v;
        viewer.clock.shouldAnimate = true;
        viewer.scene.imageryLayers.addImageryProvider(new VRGlobe.ImageryLayer(VRGlobe.Type.IMAGERYESRIIMG));
        viewer.scene.imageryLayers.addImageryProvider(
            new VRGlobe.TileCoordinatesImageryProvider()
        );

        viewer.scene.debugShowFramesPerSecond = true;

        var points = viewer.scene.primitives.add(new VRGlobe.PointPrimitiveCollection());
        var point = points.add({
            // 500101
            // position: VRGlobe.Cartesian3.fromDegrees(108.40, 30.59),

            // 500102
            position: VRGlobe.Cartesian3.fromDegrees(107.29, 29.64),
            pixelSize: 10,
            color: VRGlobe.Color.RED,
        });

        // 测试
        // var layer = new VRGlobe.VectorTileLayer(url, {
        //     rectangle: VRGlobe.Rectangle.fromDegrees(107.31726081800011, 29.515553096000115, 107.4271793970001, 29.71468762000003)
        // });
        // viewer.scene.imageryLayers.addImageryProvider(layer);

        // viewer.camera.setView({
        //     destination: new VRGlobe.Cartesian3(-1667329.8748635931, 5330211.291048239, 3142079.908661781),
        //     orientation: new VRGlobe.HeadingPitchRoll(0, -1.556809110872599, 0)
        // });


        // viewer.camera.flyToBoundingSphere(point._collection._boundingVolume);

        // viewer.terrainProvider = new VRGlobe.TerrainLayer(VRGlobe.Type.TERRAIN, {
        //     url: "http://192.168.1.115:8888/Terrain/terrain"
        // });

        // let pointGeojson;
        // VRGlobe.Resource.fetchJson({
        //     url: 'http://127.0.0.1:129/SDKData/Point.json'
        // }).then(data => {
        //     pointGeojson = data;
        // });

        // let lineStringGeojson;
        // VRGlobe.Resource.fetchJson({
        //     url: 'http://127.0.0.1:129/SDKData/Polyline.json'
        // }).then(data => {
        //     lineStringGeojson = data;
        // });

        // let polygonGeojson;
        // VRGlobe.Resource.fetchJson({
        //     url: 'http://127.0.0.1:129/SDKData/Polygon.json'
        //     // url: 'http://127.0.0.1:129/SDKData/zzq2.geojson'
        // }).then(data => {
        //     polygonGeojson = data;
        // });



        // const viewModel = {
        //     name: '11313',
        //     emissionRate: 5.0,
        //     gravity: 0.0,
        //     minimumParticleLife: 1.2,
        //     maximumParticleLife: 1.2,
        //     minimumSpeed: 1.0,
        //     maximumSpeed: 4.0,
        //     startScale: 1.0,
        //     endScale: 5.0,
        //     particleSize: 25.0,
        //     image: "http://localhost:129/SampleData/smoke.png",
        //     startColor: VRGlobe.Color.LIGHTSEAGREEN.withAlpha(0.7),
        //     endColor: VRGlobe.Color.WHITE.withAlpha(0.0),
        //     lifetime: 16.0,
        //     bursts: [{
        //         time: 5.0,
        //         minimum: 10,
        //         maximum: 100,
        //     }],
        //     hpr: [0.0, 0.0, 0.0],
        //     position: new VRGlobe.Position3D(-75.1578, 39.9786)
        // };

        // const fire = {
        //     image: "http://localhost:129/SampleData/fire.png",
        //     show: true,
        //     lifetime: 6.0,
        //     minimumImageSize: new VRGlobe.Cartesian2(6, 6),
        //     maximumImageSize: new VRGlobe.Cartesian2(24, 24),
        //     minimumParticleLife: 1,
        //     maximumParticleLife: 2,
        //     startScale: 0.5,
        //     endScale: 8.0,
        //     minimumSpeed: 0.05,
        //     maximumSpeed: 2,
        //     emitter: "circle",
        //     emissionRate: 60,
        //     gravity: 0.5,
        //     emitterRadius: 0.03,
        // }

        // const smoke = {
        //     image: "http://localhost:129/SampleData/smoke.png",
        //     show: true,
        //     lifetime: 10,
        //     hpr: [0.0, 0.0, 0.0],
        //     startColor: new VRGlobe.Color(0.9607843137254902, 0.9607843137254902, 0.9607843137254902, 0.25),
        //     endColor: new VRGlobe.Color(0.9607843137254902, 0.9607843137254902, 0.9607843137254902, 0.009999999999999998),
        //     particleSize: 24,
        //     minimumParticleLife: 5,
        //     maximumParticleLife: 10,
        //     startScale: 1.0,
        //     endScale: 8.0,
        //     minimumSpeed: 0.05,
        //     maximumSpeed: 2,
        //     gravity: 0.1,
        //     emitter: "box",
        //     emitterRadius: 0.1,
        //     emissionRate: 100,
        //     minimumMass: 1,
        //     maximumMass: 10,
        // };

        // const water = {
        //     image: "http://localhost:129/SampleData/smoke.png",
        //     show: true,
        //     // color: Cesium.Color.ALICEBLUE,
        //     color: VRGlobe.Color.fromBytes(240, 248, 255, 255),
        //     lifetime: 4.0,
        //     // direction: [0.0, 0.0, 0.0],
        //     // particleSize: [10, 40],
        //     minimumImageSize: new VRGlobe.Cartesian2(10, 10),
        //     maximumImageSize: new VRGlobe.Cartesian2(40, 40),
        //     particleLife: 4,
        //     // scale: [1, 2],
        //     startScale: 1.0,
        //     endScale: 2.0,
        //     speed: 1,
        //     gravity: -5,
        //     emitter: "cone",
        //     emissionRate: 120,
        //     emitterRadius: 1,
        //     direction: { heading: 0, pitch: 0, roll: 0 },
        // };

        // const waterSpout = {
        //     direction: {
        //         heading: 0,
        //         pitch: 90,
        //         roll: 0,
        //     },


        //     image: "http://localhost:129/SampleData/smoke.png",
        //     show: true,
        //     // color: Cesium.Color.ALICEBLUE,
        //     color: VRGlobe.Color.fromBytes(229, 241, 249, 255 * 0.35),
        //     lifetime: 10.0,
        //     // direction: [0.0, 0.0, 0.0],
        //     // particleSize: [10, 40],
        //     minimumImageSize: new VRGlobe.Cartesian2(10, 10),
        //     maximumImageSize: new VRGlobe.Cartesian2(40, 40),
        //     // particleLife: 4,
        //     minimumParticleLife: 1,
        //     maximumParticleLife: 10,
        //     // scale: [1, 2],
        //     startScale: 1.0,
        //     endScale: 2.0,
        //     // speed: 1,
        //     minimumSpeed: 3,
        //     maximumSpeed: 4,
        //     gravity: -1.5,
        //     emitter: "cone",
        //     minimumMass: 0.5,
        //     maximumMass: 10,
        //     emissionRate: 240,
        //     emitterRadius: 1,
        //     direction: { heading: 0, pitch: 90, roll: 0 },
        // };

        // const burst = {
        //     show: true,
        //     lifetime: 5,
        //     loop: true,
        //     // hpr: [0.0, 0.0, 0.0],
        //     image: "http://localhost:129/SampleData/fire.png",
        //     color: VRGlobe.Color.fromBytes(238, 85, 34, 255 * 0.05),
        //     bursts: [
        //         { time: 3.5, minimum: 1000, maximum: 5000 },
        //         { time: 3.6, minimum: 1000, maximum: 4000 },
        //         { time: 3.7, minimum: 1000, maximum: 3000 },
        //         { time: 3.8, minimum: 1000, maximum: 2000 },
        //     ],
        //     minimumImageSize: new VRGlobe.Cartesian2(12, 12),
        //     maximumImageSize: new VRGlobe.Cartesian2(24, 24),
        //     minimumParticleLife: 0.5,
        //     maximumParticleLife: 1,
        //     startScale: 1.0,
        //     endScale: 8.0,
        //     minimumSpeed: 0.05,
        //     maximumSpeed: 1.0,
        //     emitter: "box",
        //     emissionRate: 0,
        //     gravity: 0.1,
        //     emitterRadius: 0.03,
        // }

        // function createParticle(options) {
        //     const bursts = new Array();
        //     options.bursts.forEach(burst => {
        //         bursts.push(new VRGlobe.ParticleBurst(burst));
        //     });

        //     options.bursts = bursts;
        //     console.log(options);

        //     // return new VRGlobe.ParticleSystem({
        //     //     image: options.image,

        //     //     startColor: options.startColor,
        //     //     endColor: options.endColor,

        //     //     startScale: options.startScale,
        //     //     endScale: options.endScale,

        //     //     minimumParticleLife: options.minimumParticleLife,
        //     //     maximumParticleLife: options.maximumParticleLife,

        //     //     minimumSpeed: options.minimumSpeed,
        //     //     maximumSpeed: options.maximumSpeed,

        //     //     imageSize: new VRGlobe.Cartesian2(
        //     //         options.particleSize,
        //     //         options.particleSize
        //     //     ),

        //     //     emissionRate: options.emissionRate,

        //     //     bursts: options.bursts,

        //     //     lifetime: options.lifetime,

        //     //     emitter: new VRGlobe.CircleEmitter(2.0),

        //     //     updateCallback: (p, dt) => {
        //     //         const gravityScratch = new VRGlobe.Cartesian3();
        //     //         const position = p.position;

        //     //         VRGlobe.Cartesian3.normalize(position, gravityScratch);
        //     //         VRGlobe.Cartesian3.multiplyByScalar(
        //     //             gravityScratch,
        //     //             options.gravity * dt,
        //     //             gravityScratch
        //     //         );

        //     //         p.velocity = VRGlobe.Cartesian3.add(
        //     //             p.velocity,
        //     //             gravityScratch,
        //     //             p.velocity
        //     //         );
        //     //     },
        //     //     modelMatrix: VRGlobe.Transforms.eastNorthUpToFixedFrame(VRGlobe.Cartesian3.fromDegrees(
        //     //         -75.15787310614596,
        //     //         39.97862668312678
        //     //     ))
        //     // })

        // }

        // let particle = viewer.scene.primitives.add(createParticle(viewModel));

        // VRGlobe.Loader.loadJson('http://127.0.0.1:129/Data/Topojson/3269-688.topojson').then(data => {
        //     VRGlobe.Format.convertTo(data, VRGlobe.Format.TOPOJSON, VRGlobe.Format.IMG);
        // });

        // VRGlobe.GeoJsonDataSource.load('http://127.0.0.1:129/Data/Topojson/3269-688.topojson', {
        //     stroke: VRGlobe.Color.HOTPINK,
        //     fill: VRGlobe.Color.PINK,
        //     strokeWidth: 3
        // }).then(source => {
        //     viewer.zoomTo(source);
        // })

        // let topojson;
        // const x = 3269, y = 688, z = 11;
        // var resource = VRGlobe.Resource.createIfNeeded(url.replace('{x}', x).replace('{y}', y).replace('{z}', z));

        // const parameters = {};
        // const _parameters = resource._queryParameters;

        // parameters.LAYER = _parameters.LAYER;
        // parameters.STYLE = _parameters.STYLE;
        // parameters.REQUEST = _parameters.REQUEST;
        // parameters.SERVICE = _parameters.SERVICE;
        // parameters.TILECOL = _parameters.TILECOL;
        // parameters.TILEROW = _parameters.TILEROW;
        // parameters.VERSION = _parameters.VERSION;
        // parameters.TILEMATRIX = _parameters.TILEMATRIX;
        // parameters.TILEMATRIXSET = _parameters.TILEMATRIXSET;
        // parameters.FORMAT = `${_parameters.FORMAT};type=${_parameters.type}`;

        // resource.setQueryParameters(parameters, false);
        // resource.fetchJson().then(json => {
        //     console.log(json);
        //     topojson = new VRGlobe.TopoJson(json);
        //     var rect = viewer.terrainProvider.tilingScheme.tileXYToRectangle(x, y, z);
        //     topojson.toIMG(256, 256, rect);

        // });

    </script>
</body>

</html>